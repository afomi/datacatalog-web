<% content_for :title do %>
  <%= @source.title %>
<% end %>

<%= render 'tabs' %>

<% content_for :body_class do %>home<% end %>

<div id="ltColumn">
  <%= show_flash_message %>  

  <p><%= @source.description %></p>
  <div class="module">
    <div id="dataDetails">
      <div id="metaDetails">
        <dl>
          
          <%= source_field :attribute => :organization_id, :label => "Organization",
                           :value => DataCatalog::Organization.get(@source.organization_id).name, 
                           :url => "#" %>
          
          <%= source_field :attribute => :categories, :collection => true, :label => "Category",
                           :value => "", :url => "#"%>
                           
          <%= source_field :attribute => :url, :label => "Homepage",
                           :value => truncate(@source.url, :length => 35), :url => @source.url %>

          <%= source_field :attribute => :documentation_url, :label => "Official Docs",
                           :value => truncate(@source.documentation_url, :length => 35), :url => @source.documentation_url %>

          <%= source_field :attribute => :license, :label => "License",
                           :value => @source.license, :url => @source.license_url %>
          
          <%= source_field :attribute => :catalog_name, :label => "Original Catalog", 
                           :value => @source.catalog_name, :url => @source.catalog_url %>
                           
          <%= source_field :attribute => :released, :label => "Released", 
                           :value => @source.released.to_s %>
                           
          <%= source_field :attribute => :period_start, :label => "Period", 
                           :value => @source.period_start.to_s + " to " + @source.period_end.to_s %>

          <%= source_field :attribute => :frequency, :label => "Frequency", 
                           :value => @source.frequency.to_s.titlecase %>

          <% if @source.frequency -%>
          <dt>Frequency</dt>
          <dd><%= @source.frequency %></dd>
          <% end -%>
          
        </dl>
        
        <% unless @source.custom.empty? -%>
        <a class="allLink" id="additionalData_information" href="#">View Additional Information</a>
        <% end -%>
      </div>

      <div id="ratingBox">
        <div class="stars" id="overallRating">
          <h3 class="textReplace withTip" id="header_overall">Overall Rating</h3>
          <%= render 'shared/star_rating', :rating => (@source.rating_stats.average ? @source.rating_stats.average.round : nil) %>
          <div class="tip">(averaged from <%= rating_count(@source.rating_stats.average, @source.rating_stats.total) %> votes)</div>
        </div>
        <div class="stars" id="yourRating">
          <h3 class="textReplace" id="header_your">Your Rating</h3>
          <ul class="you-star-rating star-ratingActive">
            <li title="Unusable" class="oneStar">
              <%= link_to 1, source_rating_path(@source.slug, 1) %>
            </li>
            <li title="Bad" class="twoStars">
              <%= link_to 2, source_rating_path(@source.slug, 2) %>
            </li>
            <li title="Fair" class="threeStars">
              <%= link_to 3, source_rating_path(@source.slug, 3) %>
            </li>
            <li title="Good" class="fourStars">
              <%= link_to 4, source_rating_path(@source.slug, 4) %>
            </li>
            <li title="Great" class="fiveStars">
              <%= link_to 5, source_rating_path(@source.slug, 5) %>
            </li>
          </ul>
        </div>
      </div> 

      <div class="clear"></div> 
    </div> 

    <div id="downloadFormats">
      <h3>Available Formats for Download</h3>
      <ul>
        <li>
          <a href="#">XML</a>
          <span>(15MB)</span>
        </li>
        <li>
          <a href="#">CSV</a>
          <span>(15MB)</span>
        </li>
        <li>
          <a href="#">XLS</a>
          <span>(15MB)</span>
        </li>
      </ul>   
      <div class="clear"></div> 
    </div> 
  </div>
  <div class="module">
    <h3>Example of Data</h3>

  </div>    	           
</div> 
<div id="rtColumnWrapper">
  <div id="rtColumn">
    <%= render 'sidebar_favorites' %>
    <%= render 'sidebar_notes' %>
  </div> 
</div>
<div class="clear"></div> 
<div id="commentBox">
  <h3 id="discussionTitle">Discussion</h3>
  <span id="numberComments"><%= @source.comments.length %></span>
  <div class="clear"></div>
  <!-- Render "Most Useful" here-->
  <div id="threadedComments">
    <%= render 'comments', :comments => @comments %>
  </div>
  <a name="comment_form" id="comment_form"></a>
  <% if current_user -%>
  <h3 class="withTip">Your Thoughts</h3>
  <p class="tip">Have some findings to share? Run across something that was missing or broken? Please leave us a comment below.</p>
  
  <% form_for @comment, :url => source_comment_path(@source.slug), :method => :post, :html => { :id => "comment" } do |f| %>
    <%= f.hidden_field :parent_id, :value => @parent_id %>
    
    <%= f.label :comment, "Comment", :id => "commentLabel" %>
    <%= f.text_area :text, :id => "commentTextarea", :class => "textarea full", :rows => 5, :cols => 32 %>
    
    <div id="commentReport">
      <label id="problemLabel">This Comment:</label>
      <label>
        <input id="comment_reports_problem" class="checkbox" type="checkbox" <%= "checked='checked'" if @reports_problem %> value="1" name="comment[reports_problem]"/>
        Reports a Problem in the Data
      </label>
    </div>
    
    <button title="post" class="postComment" type="submit">
      <span>Post Comment</span>
    </button>
    
  <% end %>
  <% else -%>
  <h3 class="withTip">Sign in to comment</h3>
  <p class="tip">To leave a comment or report a problem with this data, you must <%= link_to "sign in", signin_url %>. No account yet? <%= link_to "Sign up", signup_url %>.</p>
  <% end -%>
</div>        
